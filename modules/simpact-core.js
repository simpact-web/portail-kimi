const SimpactCore={DEFAULT_USERS:[{id:"youssef",pass:"ni3Shaey",role:"superadmin",name:"Youssef (PDG)",redirect:"dashboard.html"},{id:"admin01",pass:"simpact2026",role:"admin",name:"Admin Simpact",redirect:"dashboard.html"},{id:"prod01",pass:"atelier",role:"production",name:"Chef Atelier",redirect:"pages/production.html"},{id:"compta01",pass:"facture",role:"compta",name:"Service Compta",redirect:"pages/compta.html"},{id:"comm01",pass:"vente",role:"commercial",name:"Commercial 1",redirect:"pages/commercial.html"},{id:"client01",pass:"client123",role:"client",name:"Agence Pub",redirect:"pages/client.html"},{id:"client02",pass:"1234",role:"client",name:"Restaurant Le Chef",redirect:"pages/client.html"}],auth:{login(e,s){if(!e||!s)return null;const r=this.getAllUsers().find(r=>r.id.toLowerCase()===e.toLowerCase()&&r.pass===s);return r?(localStorage.setItem("SIMPACT_USER",JSON.stringify(r)),r):null},logout(){localStorage.removeItem("SIMPACT_USER"),window.location.href="../index.html"},checkAuth(e){const s=localStorage.getItem("SIMPACT_USER");if(!s)return window.location.href="../index.html",null;const r=JSON.parse(s);if("superadmin"===r.role)return r;if(!e)return r;const t=Array.isArray(e)?e:[e];return t.includes(r.role)?r:(alert("⛔ Accès interdit !"),window.location.href=r.redirect||"../index.html",null)},getCurrentUser(){const e=localStorage.getItem("SIMPACT_USER");return e?JSON.parse(e):null},getAllUsers(){const e=localStorage.getItem("SIMPACT_USERS");return e?JSON.parse(e):[...SimpactCore.DEFAULT_USERS]},saveUser(e){const s=this.getAllUsers(),r=s.findIndex(s=>s.id===e.id);return r>=0?s[r]=e:s.push(e),localStorage.setItem("SIMPACT_USERS",JSON.stringify(s)),!0},deleteUser(e){if("youssef"===e)return!1;let s=this.getAllUsers();return s=s.filter(s=>s.id!==e),localStorage.setItem("SIMPACT_USERS",JSON.stringify(s)),!0}},orders:{getAll(){try{return JSON.parse(localStorage.getItem("SIMPACT_ORDERS"))||[]}catch(e){return[]}},save(e){let s=this.getAll();return s=s.filter(s=>s.ref!==e.ref),s.unshift(e),s.length>100&&s.pop(),localStorage.setItem("SIMPACT_ORDERS",JSON.stringify(s)),e},updateStatus(e,s,r="prod"){let t=this.getAll();const o=t.find(r=>r.ref===e);return o?(r===prod?o.statusProd=s:o.statusCompta=s,o.lastModified=(new Date).toISOString(),localStorage.setItem("SIMPACT_ORDERS",JSON.stringify(t)),!0):!1},generateRef(){return"D-"+Date.now().toString().slice(-6)}},stock:{getAll(){try{return JSON.parse(localStorage.getItem("SIMPACT_STOCK"))||[]}catch(e){return[]}},getStats(){const e=this.getAll(),s={totalTypes:e.length,totalQty:0,totalValue:0,alerts:0};return e.forEach(e=>{s.totalQty+=e.qty,s.totalValue+=e.qty*(e.price||0),(e.qty/e.threshold*100)<=100&&s.alerts++}),s},checkAlerts(){return this.getAll().filter(e=>(e.qty/e.threshold*100)<=100)}},stats:{getRevenue(e="all"){let s=SimpactCore.orders.getAll();if("today"===e){const e=(new Date).toLocaleDateString();s=s.filter(s=>s.date===e)}return s.reduce((e,s)=>e+parseFloat(s.price||0),0)}}};window.SimpactCore=SimpactCore,window.login=(e,s)=>SimpactCore.auth.login(e,s),window.logout=()=>SimpactCore.auth.logout(),window.checkAuth=e=>SimpactCore.auth.checkAuth(e),window.getOrders=()=>SimpactCore.orders.getAll(),window.saveOrder=e=>SimpactCore.orders.save(e);
